<!DOCTYPE html>
<html>
<head>
  <title>PDFに文字を描画</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.14.305/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
</head>
<body>
  <input type="file" id="fileInput">
  <canvas id="myCanvas"></canvas>
  <button onclick="drawText()">文字を描画</button>
  <button onclick="downloadPDF()">PDFをダウンロード</button>

  <script>
    const fileInput = document.getElementById('fileInput');
    const canvas = document.getElementById('myCanvas');
    const ctx = canvas.getContext('2d');
    let pdfDoc = null;

    fileInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = (event) => {
        const arrayBuffer = event.target.result;
        pdfjsLib.getDocument(arrayBuffer).promise.then((pdf) => {
          pdfDoc = pdf;
          renderPage(1); // 1ページ目を表示
        });
      };
      reader.readAsArrayBuffer(file);
    });

    function renderPage(num) {
      pdfDoc.getPage(num).then(function(page) {
        const viewport = page.getViewport({ scale: 1.0 });
        canvas.width = viewport.width;
        canvas.height = viewport.height;

        const renderContext = {
          canvasContext: ctx,
          viewport: viewport
        };
        page.render(renderContext).promise.then(() => {
          // 描画完了
        });
      });
    }

    function drawText() {
      ctx.font = "30px Arial";
      ctx.fillStyle = "red";
      ctx.fillText("Hello, World!", 100, 100);
    }

    function downloadPDF() {
      const imgData = canvas.toDataURL('image/png');
      const pdf = new jsPDF();
      pdf.addImage(imgData, 'PNG', 0, 0);
      pdf.save('output.pdf');
    }
  </script>
</body>
</html>
